# AutoPentest

自动化渗透测试工具，以 LLM 作为驱动引擎，支持动态漏洞挖掘。

## 功能特性

- **模块化架构**: 易于扩展新的漏洞检测模块
- **LLM 驱动**: 利用大语言模型进行智能分析和 Payload 生成
- **多种报告格式**: 支持 JSON 和 HTML 格式报告
- **POC 记录**: 完整记录漏洞验证的请求响应流量

## 当前支持（MVP 版本）

- SQL 注入检测
  - 基于错误的 SQL 注入
  - 基于布尔的 SQL 注入
  - 基于时间的 SQL 注入
  - 基于联合查询的 SQL 注入

## 环境要求

- Python 3.8+
- pip

## 安装

1. 克隆项目

```bash
git clone https://github.com/yourusername/autopentest.git
cd autopentest
```

2. 安装依赖

```bash
pip install -r requirements.txt
```

3. 配置环境变量（可选）

```bash
cp .env.example .env
# 编辑 .env 文件，填入你的 LLM API 配置
```

## 使用方法

### 扫描单个端点

```bash
python -m autopentest.main --target http://example.com --endpoint "/api/user?id=1"
```

### 使用常见测试端点扫描

```bash
python -m autopentest.main --target http://example.com --test-endpoints
```

### 生成 HTML 报告

```bash
python -m autopentest.main --target http://example.com --test-endpoints --report-format html
```

### 指定输出目录

```bash
python -m autopentest.main --target http://example.com --test-endpoints --output-dir ./reports
```

## 命令行参数

| 参数 | 简写 | 说明 |
|------|------|------|
| `--target` | `-t` | 目标 URL（必需） |
| `--endpoint` | `-e` | 要扫描的具体端点 |
| `--test-endpoints` | - | 使用常见测试端点进行扫描 |
| `--analyzers` | `-a` | 要使用的分析器（默认: sqli） |
| `--report-format` | `-r` | 报告格式：json/html/both（默认: json） |
| `--output-dir` | `-o` | 报告输出目录 |
| `--no-llm` | - | 禁用 LLM 分析 |

## 项目结构

```
autopentest/
├── core/                    # 核心基础模块
│   ├── base_scanner.py     # 扫描器基类
│   ├── requester.py        # HTTP 请求封装
│   └── poc_recorder.py     # POC 记录器
│
├── analyzers/               # 漏洞分析模块
│   ├── base_analyzer.py    # 分析器基类
│   └── sql_injection.py    # SQL 注入检测
│
├── llm/                     # LLM 引擎模块
│   ├── llm_client.py       # LLM 客户端
│   └── prompt_templates.py # Prompt 模板
│
├── reporters/               # 报告生成模块
│   ├── base_reporter.py    # 报告器基类
│   ├── json_reporter.py    # JSON 格式
│   └── html_reporter.py    # HTML 格式
│
├── config/                  # 配置文件
│   └── settings.py         # 全局配置
│
├── utils/                   # 工具模块
│   ├── logger.py           # 日志工具
│   └── helpers.py          # 辅助函数
│
└── main.py                  # 程序入口
```

## 扩展开发

### 添加新的漏洞检测模块

1. 在 `analyzers/` 目录下创建新的分析器类，继承 `BaseAnalyzer`
2. 实现 `analyze()` 方法
3. 在 `main.py` 中注册新的分析器

### 添加新的报告格式

1. 在 `reporters/` 目录下创建新的报告器类，继承 `BaseReporter`
2. 实现 `generate()` 方法
3. 在命令行参数中添加新的格式选项

## 注意事项

- 本工具仅用于授权的安全测试
- 请遵守相关法律法规和道德准则
- 使用 LLM 功能需要配置相应的 API 密钥

## 后续计划

- [ ] 添加 RCE 检测模块
- [ ] 添加 XSS 检测模块
- [ ] 添加 SSRF 检测模块
- [ ] 实现信息收集模块
- [ ] 支持更多 LLM 提供商
- [ ] 添加并发扫描支持

## 许可证

MIT License

## 免责声明

本工具仅供学习和授权安全测试使用。使用者需自行承担使用本工具产生的一切后果和法律责任。
